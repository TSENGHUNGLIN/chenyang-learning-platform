# 晨陽同仁成長分析 - 專案待辦事項

## 調整側邊欄選單順序（2025-01-22）

### 第一次調整（已完成）
- [x] 在 DashboardLayout.tsx 中調整選單項目順序
- [x] 將「補考管理」移到「考試監控」之上
- [x] 測試導航功能
- [x] 儲存檢查點
- [x] 將「考卷範本」移到「分類管理」之上
- [x] 測試新選單順序
- [x] 儲存檢查點

### 第二次調整（進行中）
- [x] 在 DashboardLayout.tsx 中調整選單項目順序
- [x] 將「評核日曆」之下的項目調整為：分類管理 → 標籤管理 → 檔案管理 → AI分析出題
- [x] 測試導航功能
- [x] 儲存檢查點

---

## 考試不及格處理機制（2025-01-22）

### 階段一：資料庫架構設計與補考機制實作
- [x] 設計補考資料表（makeupExams）
- [x] 新增考試狀態欄位（failed、makeup_pending、makeup_completed）
- [x] 實作自動標記不及格考生功能
- [x] 建立補考安排 API（createMakeupExam）
- [x] 實作補考次數限制邏輯
- [x] 實作補考截止日期管理
- [x] 建立補考管理介面（管理員/編輯者專用）
- [x] 測試補考機制

### 階段二：重新學習建議系統開發
- [x] 建立學習建議資料表（learningRecommendations）
- [x] 實作錯題分析演算法
- [x] 建立「需加強知識點」生成邏輯
- [ ] 整合 AI 生成學習建議功能
- [x] 實作相關題目推薦演算法
- [x] 建立學習建議顯示頁面（考生端）
- [ ] 測試學習建議功能

### 階段三：通知提醒系統整合
- [x] 實作不及格通知功能（通知考生）
- [x] 實作補考提醒功能（考試前3天、1天）
- [x] 實作管理員關注名單通知
- [x] 建立通知記錄表（notifications）
- [x] 實作通知歷史查詢功能
- [ ] 測試通知系統

### 階段四：進度追蹤儀表板實作
- [x] 建立「待補考」考試狀態標記
- [x] 建立補考進度儀表板頁面
- [x] 實作補考統計圖表（補考率、通過率）
- [x] 實作成績變化追蹤
- [ ] 測試進度追蹤功能

### 階段五：整合測試與交付
- [ ] 測試完整的不及格處理流程
- [ ] 測試補考機制
- [ ] 測試學習建議功能
- [ ] 測試通知系統
- [ ] 測試進度追蹤功能
- [ ] 編寫完整的測試案例
- [ ] 儲存檢查點並交付

---

## 已完成功能（歷史記錄）

### 改進現有預視功能（2025-01-22）
- [x] CSV 預覽改進
- [x] 考卷範本預覽功能
- [x] 檔案預覽改進
- [x] 題目預覽改進
- [x] 考試預覽功能
- [x] 測試和優化

### UI全站優化：蘋果風格設計應用（2025-01-22）
- [x] 移除首頁的「快速搜尋」區塊
- [x] 移除首頁的「支援檔案格式說明」區塊
- [x] 在檔案管理頁面的上傳對話框中加入檔案格式說明
- [x] 將蘋果風格卡片設計應用到所有頁面

### 線上考試系統
- [x] 設計考試資料庫schema
- [x] 實作考試建立和管理功能
- [x] 實作考生作答介面
- [x] 實作自動評分系統
- [x] 實作成績查看頁面
- [x] 實作考試統計報表
- [x] 實作人工評分介面
- [x] 實作成績匯出功能
- [x] 實作考試狀態管理
- [x] 實作考卷範本系統

### 題庫管理系統
- [x] 設計題庫資料庫schema
- [x] 建立題庫管理頁面
- [x] 實作新增/編輯/刪除考題功能
- [x] 實作題目分類和標籤系統
- [x] 實作批次匯入功能（CSV）
- [x] 實作題庫檔案系統
- [x] 實作題目回收站功能
- [x] 整合AI出題功能

### 基礎功能
- [x] Google OAuth登入整合
- [x] 邀請制存取控制
- [x] 角色權限管理
- [x] 部門與人員管理
- [x] 檔案上傳與管理
- [x] 搜尋功能
- [x] 使用者管理



## 麵包屑導航功能（2025-01-22）

- [x] 建立 Breadcrumb 元件（使用 shadcn/ui）
- [x] 定義所有頁面的路徑映射和層級關係
- [x] 建立 PageHeader 元件整合麵包屑和色塊設計
- [ ] 在所有頁面中整合 PageHeader（待繼續實作）
- [ ] 測試所有頁面的麵包屑顯示
- [ ] 測試麵包屑連結導航功能
- [x] 儲存檢查點

---

## 頁面UI優化：蘋果風格色塊設計（2025-01-22）

- [x] 為15個功能頁面設計彩色色塊配置（蘋果風格）
- [x] 優化首頁佈局：將「最新活動報告」移至最下方
- [x] 在首頁加入色塊設計（藍色主題）
- [ ] 在其他頁面陸續加入色塊設計（待繼續實作）
- [ ] 在評核日曆頁面加入色塊設計
- [ ] 在分類管理頁面加入色塊設計
- [ ] 在標籤管理頁面加入色塊設計
- [ ] 在檔案管理頁面加入色塊設計
- [ ] 在AI分析出題頁面加入色塊設計
- [ ] 在題庫管理頁面加入色塊設計
- [ ] 在題庫檔案頁面加入色塊設計
- [ ] 在考卷範本頁面加入色塊設計
- [ ] 在考試園地頁面加入色塊設計
- [ ] 在考試管理頁面加入色塊設計
- [ ] 在補考管理頁面加入色塊設計
- [ ] 在考試監控頁面加入色塊設計
- [ ] 在部門人員頁面加入色塊設計
- [ ] 在使用者管理頁面加入色塊設計
- [ ] 測試所有頁面的視覺效果
- [ ] 儲存檢查點



## 側邊欄選單彩色設計（2025-01-22）

- [x] 為側邊欄選單項目加入彩色圖示背景
- [x] 為15個選單項目配置獨特的顏色標識
- [x] 優化選單項目的卡片式視覺效果
- [x] 加入 hover 和 active 狀態的動畫效果
- [x] 測試側邊欄在展開和收合狀態下的顯示效果
- [x] 儲存檢查點




## 緊急錯誤修復：考試答題頁面 JSON.parse 錯誤（2025-01-22）

- [x] 診斷錯誤原因（JSON.parse(...).map is not a function）
- [x] 修復 ExamTake.tsx 第543行的選項解析邏輯
- [x] 新增錯誤處理機制（try-catch + Array.isArray 檢查）
- [x] 測試修復結果
- [x] 儲存檢查點




## 題目資料品質管理系統（2025-01-22）

### 階段一：資料庫清理腳本
- [x] 建立資料庫清理腳本（scripts/fix-question-options.mjs）
- [x] 掃描所有題目的 options 欄位
- [x] 識別物件格式的選項並轉換為陣列格式
- [x] 執行批次修復並記錄修復結果（14道題目已修復）
- [x] 測試修復後的資料格式

### 階段二：前端選項格式驗證
- [x] 在 QuestionBank.tsx 的新增/編輯對話框加入驗證邏輯
- [x] 驗證選項必須為陣列格式
- [x] 驗證每個選項必須包含 label 和 value 欄位（支援字串和物件格式）
- [x] 顯示即時驗證錯誤訊息
- [ ] 測試驗證功能

### 階段三：資料品質檢查工具
- [x] 建立 DataQualityCheck.tsx 頁面
- [x] 建立 dataQualityCheck.ts 後端模組
- [x] 實作選項格式檢查 API
- [x] 實作缺少必要欄位檢查 API
- [x] 實作批次修復功能
- [x] 在側邊欄新增「資料品質檢查」選單項目（編輯者專用）
- [ ] 測試品質檢查工具

### 階段四：整合測試與交付
- [x] 測試資料庫清理腳本（14道題目已修復）
- [x] 測試前端驗證功能（TypeScript 編譯無錯誤）
- [x] 測試品質檢查工具（3個測試全部通過）
- [x] 儲存檢查點並交付




## 側邊欄選單順序調整 - 資料品質檢查位置（2025-01-22）

- [x] 將「資料品質檢查」移到「檔案管理」之上
- [x] 測試選單顯示順序
- [x] 儲存檢查點



## 考題品質檢查重新命名和位置調整（2025-01-22）

- [x] 將「資料品質檢查」改名為「考題品質檢查」
- [x] 調整選單順序：移到「題庫管理」之上、「AI分析出題」之下
- [x] 更新DashboardLayout.tsx中的選單項目名稱
- [x] 更新DataQualityCheck.tsx頁面標題
- [x] 測試選單顯示順序和名稱
- [x] 儲存檢查點



## 考題品質檢查頁面新增返回首頁按鈕（2025-01-22）

- [x] 在DataQualityCheck.tsx頁面右上角新增「返回首頁」按鈕
- [x] 使用Home圖示和outline variant樣式
- [x] 測試按鈕功能
- [x] 儲存檢查點



## 修復檔案管理頁面 CSV 解析錯誤（2025-01-22）

- [x] 診斷 iconv.decode is not a function 錯誤原因
- [x] 修復 CSV 解析邏輯（降級 iconv-lite 到 0.6.3 版本）
- [x] 重啟開發伺服器載入新套件
- [x] 清除 Vite 快取並重新安裝依賴
- [x] 移除專門的 CSV 預覽按鈕
- [x] 修改預視對話框（移除 CSV 預覽功能）
- [x] 確認 CSV 預覽按鈕已移除
- [x] 儲存檢查點




## CSV 線上預視功能實作（2025-01-22）

- [x] 建立前端 CSV 解析工具（csvParser.ts）
- [x] 建立 CSVTableView 元件（表格顯示）
- [x] 實作欄位排序功能（升序/降序）
- [x] 實作搜尋篩選功能（跨欄位搜尋）
- [x] 實作分頁功能（每頁 20 行）
- [x] 整合到 Files.tsx 的預視對話框
- [x] 使用後端 API 載入 CSV（避免 CORS 問題）
- [x] 儲存檢查點




## 修復 Files.tsx 中的 tRPC query 錯誤（2025-01-22）

- [x] 診斷錯誤原因（hooks[lastArg] is not a function）
- [x] 將 useEffect 中的 trpc.files.previewCSV.query() 改為使用 useQuery hook
- [x] 使用 enabled 選項控制 query 的觸發時機
- [x] 修復 csvLoading 變數的使用（改用 csvQuery.isLoading）
- [x] 測試修復後的 CSV 預視功能（發現新錯誤）
- [x] 修復 csvPreview.ts 中的 iconv.decode 錯誤（encodingDetector.ts 中使用 iconv.default.decode）
- [x] 再次測試 CSV 預視功能（成功！）
- [x] 儲存檢查點




## 優化 AI 分析出題功能：自動使用檔案名稱作為題目標題（2025-01-23）

- [x] 分析現有 AI 分析出題功能的實作邏輯
- [x] 修改 AI 分析出題功能，自動使用檔案名稱（移除副檔名）作為考試題目標題
- [x] 確保使用者可以透過修改檔名來控制題目標題
- [x] 測試功能並儲存檢查點


## 修復考試分析頁面錯誤（2025-01-23）

- [x] 診斷錯誤原因，檢查後端 API 和前端元件
- [x] 修復後端 API，確保返回正確的資料結構（修復欄位名稱錯誤）
- [x] 修復前端元件，加入錯誤處理和資料驗證
- [x] 測試修復結果並儲存檢查點


## 考試管理系統優化（2025-01-23）

### 1. 區分編輯按鈕功能
- [x] 分析現有的編輯按鈕實作（ExamManagement.tsx）
- [x] 將第一個編輯按鈕改為「審查編輯」（適用於已發布的考試）
- [x] 將第二個編輯按鈕改為「快速編輯」（適用於草稿狀態）
- [x] 為兩個按鈕設計不同的圖示和顏色
- [x] 根據考試狀態控制按鈕的顯示和禁用狀態

### 2. 優化考試狀態管理
- [x] 定義考試狀態邏輯（草稿/已發布/進行中/已結束）
- [x] 根據考試狀態顯示不同的操作按鈕組合
- [x] 實作狀態徽章顯示（使用不同顏色區分）
- [x] 避免功能重複，移除不必要的按鈕

### 3. 改善考試分析頁面空資料處理
- [x] 檢查 ExamAnalytics.tsx 的空資料處理邏輯
- [x] 當沒有考生資料時，顯示友善的提示訊息
- [x] 提供「指派考生」的快速連結按鈕
- [x] 優化 UI 呈現，使用空狀態插圖或圖示

### 4. 測試與驗證
- [x] 測試草稿狀態考試的按鈕顯示
- [x] 測試已發布考試的按鈕顯示
- [x] 測試進行中考試的按鈕顯示
- [x] 測試已結束考試的按鈕顯示
- [x] 測試考試分析頁面的空資料提示
- [x] 儲存檢查點




## 考試管理頁面單選功能（提升編輯穩定性）（2025-01-23）

### 1. 前端 UI 實作
- [x] 在考試列表的每一行前面加入單選方格（radio button）
- [x] 實作單選狀態管理（一次只能選擇一個考試）
- [x] 選擇考試後，顯示對應的操作按鈕區域
- [x] 未選擇考試時，顯示「請先選擇考試」提示

### 2. 操作流程優化
- [x] 選擇考試後，該行以藍色背景高亮顯示
- [x] 根據考試狀態顯示對應的操作按鈕（預覽、快速編輯、審查編輯、指派考生、刪除等）
- [x] 點擊操作按鈕時，自動使用已選擇的考試
- [x] 提供清晰的視覺回饋（選中行背景色變化）

### 3. 測試與驗證
- [x] 測試單選功能是否正常運作
- [x] 測試選擇不同考試時的按鈕變化
- [x] 測試編輯操作的穩定性
- [x] 儲存檢查點




## 考生考試規劃功能（2025-01-23）

### 階段一：資料庫結構擴展
- [x] 檢查 examAssignments 表格是否支援批次規劃需求
- [x] 新增考試規劃批次記錄表（examPlanningBatches）用於追蹤批次規劃
- [x] 新增逾期考試處理記錄表（overdueExamActions）
- [x] 執行資料庫遷移

### 階段二：後端 API 實作
- [x] 實作批次考試規劃 API（batchPlanExams）
- [x] 實作 CSV/Excel 批次匯入解析功能
- [x] 實作考生與考卷複選查詢 API
- [x] 實作逾期考試檢查與處理 API
- [x] 實作考試規劃歷史查詢 API

### 階段三：前端頁面實作
- [x] 建立「考生規劃」頁面（/exam-planning）
- [x] 實作考生選擇元件（支援單選、按部門、複選三種模式）
- [x] 實作考卷複選元件（支援搜尋和篩選）
- [x] 實作時間安排表單（為每份考卷設定開始時間和截止時間）
- [x] 實作 CSV/Excel 批次匯入對話框
- [x] 實作規劃預覽和確認功能

### 階段四：逾期處理機制
- [x] 實作自動檢查逾期考試的 API
- [x] 實作逾期標記功能
- [x] 實作截止時間延長功能
- [x] 建立逾期考試管理頁面
- [ ] 實作逾期通知發送功能（整合現有通知系統）
- [ ] 實作補考自動安排功能（整合補考管理）

### 階段五：頁面重新命名與導航整合
- [x] 將「考試管理」頁面改名為「考卷列表」
- [x] 更新 DashboardLayout.tsx 中的選單項目
- [x] 新增「考生規劃」和「逾期管理」選單項目
- [x] 更新路由配置（App.tsx）
- [x] 更新頁面標題
- [ ] 測試所有導航連結和功能### 階段六：整合測試與交付
- [x] 測試批次考試規劃功能
- [x] 測試 CSV 批次匯入功能
- [x] 測試逾期考試管理功能
- [x] 測試導航選單和頁面跳轉
- [x] 儲存檢查點測試案例
- [ ] 儲存檢查點並交付





## 考試規劃系統進階功能（2025-01-23）

### 功能一：逾期通知自動化
- [x] 設計分級通知機制（1天/3天/7天）
- [x] 建立 overdueNotifications 資料表
- [x] 實作自動檢測逾期考試的排程任務
- [x] 整合現有通知系統發送提醒
- [x] 建立通知歷史記錄功能
- [x] 避免重複通知的機制
- [x] 測試分級通知功能

### 功能二：補考自動安排
- [x] 設計補考自動建立邏輯
- [x] 整合現有 makeupExams 表格
- [x] 實作逾期後自動建立補考記錄
- [x] 設定補考預設參數（次數、間隔、截止日期）
- [x] 建立補考狀態追蹤功能
- [ ] 在逾期管理頁面顯示補考資訊
- [x] 測試補考自動安排功能

### 功能三：考試規劃範本
- [x] 建立 examPlanningTemplates 資料表
- [x] 建立 examPlanningTemplateItems 資料表
- [x] 實作範本 CRUD API
- [ ] 建立範本管理頁面
- [x] 實作從範本建立規劃功能
- [x] 支援範本匯入/匯出
- [ ] 建立預設範本（新人訓練50堂課）
- [x] 測試範本功能

### 整合測試
- [x] 測試逾期通知自動化
- [x] 測試補考自動安排
- [x] 測試考試規劃範本
- [x] 測試三個功能的整合運作
- [ ] 儲存檢查點





## 側邊欄選單名稱調整（2025-01-23）

- [x] 在 DashboardLayout.tsx 中將「題庫管理」改為「單選題庫」
- [x] 在 DashboardLayout.tsx 中將「題庫檔案」改為「試卷題庫」
- [x] 更新 QuestionBank.tsx 頁面標題和內容
- [x] 更新 QuestionBanks.tsx 頁面標題和內容
- [x] 測試選單顯示和頁面導航
- [x] 儲存檢查點



## 側邊欄選單順序調整（2025-01-23）

- [x] 在 DashboardLayout.tsx 中找到「考卷範本」選單項目
- [x] 將「考卷範本」移到「考題品質檢查」之下
- [x] 在 DashboardLayout.tsx 中找到「考試園地」選單項目
- [x] 將「考試園地」移到「逾期管理」之上
- [x] 測試側邊欄選單顯示順序
- [x] 儲存檢查點



## 將側邊欄「考生規劃」改名為「考生考試規劃」（2025-01-23）

- [x] 在 DashboardLayout.tsx 中找到「考生規劃」選單項目
- [x] 將 label 從「考生規劃」改為「考生考試規劃」
- [x] 測試側邊欄選單顯示
- [ ] 儲存檢查點


