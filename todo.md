# 晨陽同仁成長分析 - 專案待辦事項

## 調整側邊欄選單順序（2025-01-22）

### 第一次調整（已完成）
- [x] 在 DashboardLayout.tsx 中調整選單項目順序
- [x] 將「補考管理」移到「考試監控」之上
- [x] 測試導航功能
- [x] 儲存檢查點
- [x] 將「考卷範本」移到「分類管理」之上
- [x] 測試新選單順序
- [x] 儲存檢查點

### 第二次調整（進行中）
- [x] 在 DashboardLayout.tsx 中調整選單項目順序
- [x] 將「評核日曆」之下的項目調整為：分類管理 → 標籤管理 → 檔案管理 → AI分析出題
- [x] 測試導航功能
- [x] 儲存檢查點

---

## 考試不及格處理機制（2025-01-22）

### 階段一：資料庫架構設計與補考機制實作
- [x] 設計補考資料表（makeupExams）
- [x] 新增考試狀態欄位（failed、makeup_pending、makeup_completed）
- [x] 實作自動標記不及格考生功能
- [x] 建立補考安排 API（createMakeupExam）
- [x] 實作補考次數限制邏輯
- [x] 實作補考截止日期管理
- [x] 建立補考管理介面（管理員/編輯者專用）
- [x] 測試補考機制

### 階段二：重新學習建議系統開發
- [x] 建立學習建議資料表（learningRecommendations）
- [x] 實作錯題分析演算法
- [x] 建立「需加強知識點」生成邏輯
- [ ] 整合 AI 生成學習建議功能
- [x] 實作相關題目推薦演算法
- [x] 建立學習建議顯示頁面（考生端）
- [ ] 測試學習建議功能

### 階段三：通知提醒系統整合
- [x] 實作不及格通知功能（通知考生）
- [x] 實作補考提醒功能（考試前3天、1天）
- [x] 實作管理員關注名單通知
- [x] 建立通知記錄表（notifications）
- [x] 實作通知歷史查詢功能
- [ ] 測試通知系統

### 階段四：進度追蹤儀表板實作
- [x] 建立「待補考」考試狀態標記
- [x] 建立補考進度儀表板頁面
- [x] 實作補考統計圖表（補考率、通過率）
- [x] 實作成績變化追蹤
- [ ] 測試進度追蹤功能

### 階段五：整合測試與交付
- [ ] 測試完整的不及格處理流程
- [ ] 測試補考機制
- [ ] 測試學習建議功能
- [ ] 測試通知系統
- [ ] 測試進度追蹤功能
- [ ] 編寫完整的測試案例
- [ ] 儲存檢查點並交付

---

## 已完成功能（歷史記錄）

### 改進現有預視功能（2025-01-22）
- [x] CSV 預覽改進
- [x] 考卷範本預覽功能
- [x] 檔案預覽改進
- [x] 題目預覽改進
- [x] 考試預覽功能
- [x] 測試和優化

### UI全站優化：蘋果風格設計應用（2025-01-22）
- [x] 移除首頁的「快速搜尋」區塊
- [x] 移除首頁的「支援檔案格式說明」區塊
- [x] 在檔案管理頁面的上傳對話框中加入檔案格式說明
- [x] 將蘋果風格卡片設計應用到所有頁面

### 線上考試系統
- [x] 設計考試資料庫schema
- [x] 實作考試建立和管理功能
- [x] 實作考生作答介面
- [x] 實作自動評分系統
- [x] 實作成績查看頁面
- [x] 實作考試統計報表
- [x] 實作人工評分介面
- [x] 實作成績匯出功能
- [x] 實作考試狀態管理
- [x] 實作考卷範本系統

### 題庫管理系統
- [x] 設計題庫資料庫schema
- [x] 建立題庫管理頁面
- [x] 實作新增/編輯/刪除考題功能
- [x] 實作題目分類和標籤系統
- [x] 實作批次匯入功能（CSV）
- [x] 實作題庫檔案系統
- [x] 實作題目回收站功能
- [x] 整合AI出題功能

### 基礎功能
- [x] Google OAuth登入整合
- [x] 邀請制存取控制
- [x] 角色權限管理
- [x] 部門與人員管理
- [x] 檔案上傳與管理
- [x] 搜尋功能
- [x] 使用者管理



## 麵包屑導航功能（2025-01-22）

- [x] 建立 Breadcrumb 元件（使用 shadcn/ui）
- [x] 定義所有頁面的路徑映射和層級關係
- [x] 建立 PageHeader 元件整合麵包屑和色塊設計
- [ ] 在所有頁面中整合 PageHeader（待繼續實作）
- [ ] 測試所有頁面的麵包屑顯示
- [ ] 測試麵包屑連結導航功能
- [x] 儲存檢查點

---

## 頁面UI優化：蘋果風格色塊設計（2025-01-22）

- [x] 為15個功能頁面設計彩色色塊配置（蘋果風格）
- [x] 優化首頁佈局：將「最新活動報告」移至最下方
- [x] 在首頁加入色塊設計（藍色主題）
- [ ] 在其他頁面陸續加入色塊設計（待繼續實作）
- [ ] 在評核日曆頁面加入色塊設計
- [ ] 在分類管理頁面加入色塊設計
- [ ] 在標籤管理頁面加入色塊設計
- [ ] 在檔案管理頁面加入色塊設計
- [ ] 在AI分析出題頁面加入色塊設計
- [ ] 在題庫管理頁面加入色塊設計
- [ ] 在題庫檔案頁面加入色塊設計
- [ ] 在考卷範本頁面加入色塊設計
- [ ] 在考試園地頁面加入色塊設計
- [ ] 在考試管理頁面加入色塊設計
- [ ] 在補考管理頁面加入色塊設計
- [ ] 在考試監控頁面加入色塊設計
- [ ] 在部門人員頁面加入色塊設計
- [ ] 在使用者管理頁面加入色塊設計
- [ ] 測試所有頁面的視覺效果
- [ ] 儲存檢查點



## 側邊欄選單彩色設計（2025-01-22）

- [x] 為側邊欄選單項目加入彩色圖示背景
- [x] 為15個選單項目配置獨特的顏色標識
- [x] 優化選單項目的卡片式視覺效果
- [x] 加入 hover 和 active 狀態的動畫效果
- [x] 測試側邊欄在展開和收合狀態下的顯示效果
- [x] 儲存檢查點




## 緊急錯誤修復：考試答題頁面 JSON.parse 錯誤（2025-01-22）

- [x] 診斷錯誤原因（JSON.parse(...).map is not a function）
- [x] 修復 ExamTake.tsx 第543行的選項解析邏輯
- [x] 新增錯誤處理機制（try-catch + Array.isArray 檢查）
- [x] 測試修復結果
- [x] 儲存檢查點




## 題目資料品質管理系統（2025-01-22）

### 階段一：資料庫清理腳本
- [x] 建立資料庫清理腳本（scripts/fix-question-options.mjs）
- [x] 掃描所有題目的 options 欄位
- [x] 識別物件格式的選項並轉換為陣列格式
- [x] 執行批次修復並記錄修復結果（14道題目已修復）
- [x] 測試修復後的資料格式

### 階段二：前端選項格式驗證
- [x] 在 QuestionBank.tsx 的新增/編輯對話框加入驗證邏輯
- [x] 驗證選項必須為陣列格式
- [x] 驗證每個選項必須包含 label 和 value 欄位（支援字串和物件格式）
- [x] 顯示即時驗證錯誤訊息
- [ ] 測試驗證功能

### 階段三：資料品質檢查工具
- [x] 建立 DataQualityCheck.tsx 頁面
- [x] 建立 dataQualityCheck.ts 後端模組
- [x] 實作選項格式檢查 API
- [x] 實作缺少必要欄位檢查 API
- [x] 實作批次修復功能
- [x] 在側邊欄新增「資料品質檢查」選單項目（編輯者專用）
- [ ] 測試品質檢查工具

### 階段四：整合測試與交付
- [x] 測試資料庫清理腳本（14道題目已修復）
- [x] 測試前端驗證功能（TypeScript 編譯無錯誤）
- [x] 測試品質檢查工具（3個測試全部通過）
- [x] 儲存檢查點並交付




## 側邊欄選單順序調整 - 資料品質檢查位置（2025-01-22）

- [x] 將「資料品質檢查」移到「檔案管理」之上
- [x] 測試選單顯示順序
- [x] 儲存檢查點



## 考題品質檢查重新命名和位置調整（2025-01-22）

- [x] 將「資料品質檢查」改名為「考題品質檢查」
- [x] 調整選單順序：移到「題庫管理」之上、「AI分析出題」之下
- [x] 更新DashboardLayout.tsx中的選單項目名稱
- [x] 更新DataQualityCheck.tsx頁面標題
- [x] 測試選單顯示順序和名稱
- [x] 儲存檢查點



## 考題品質檢查頁面新增返回首頁按鈕（2025-01-22）

- [x] 在DataQualityCheck.tsx頁面右上角新增「返回首頁」按鈕
- [x] 使用Home圖示和outline variant樣式
- [x] 測試按鈕功能
- [x] 儲存檢查點



## 修復檔案管理頁面 CSV 解析錯誤（2025-01-22）

- [x] 診斷 iconv.decode is not a function 錯誤原因
- [x] 修復 CSV 解析邏輯（降級 iconv-lite 到 0.6.3 版本）
- [x] 重啟開發伺服器載入新套件
- [x] 清除 Vite 快取並重新安裝依賴
- [x] 移除專門的 CSV 預覽按鈕
- [x] 修改預視對話框（移除 CSV 預覽功能）
- [x] 確認 CSV 預覽按鈕已移除
- [x] 儲存檢查點




## CSV 線上預視功能實作（2025-01-22）

- [x] 建立前端 CSV 解析工具（csvParser.ts）
- [x] 建立 CSVTableView 元件（表格顯示）
- [x] 實作欄位排序功能（升序/降序）
- [x] 實作搜尋篩選功能（跨欄位搜尋）
- [x] 實作分頁功能（每頁 20 行）
- [x] 整合到 Files.tsx 的預視對話框
- [x] 使用後端 API 載入 CSV（避免 CORS 問題）
- [x] 儲存檢查點




## 修復 Files.tsx 中的 tRPC query 錯誤（2025-01-22）

- [x] 診斷錯誤原因（hooks[lastArg] is not a function）
- [x] 將 useEffect 中的 trpc.files.previewCSV.query() 改為使用 useQuery hook
- [x] 使用 enabled 選項控制 query 的觸發時機
- [x] 修復 csvLoading 變數的使用（改用 csvQuery.isLoading）
- [x] 測試修復後的 CSV 預視功能（發現新錯誤）
- [x] 修復 csvPreview.ts 中的 iconv.decode 錯誤（encodingDetector.ts 中使用 iconv.default.decode）
- [x] 再次測試 CSV 預視功能（成功！）
- [x] 儲存檢查點




## 優化 AI 分析出題功能：自動使用檔案名稱作為題目標題（2025-01-23）

- [x] 分析現有 AI 分析出題功能的實作邏輯
- [x] 修改 AI 分析出題功能，自動使用檔案名稱（移除副檔名）作為考試題目標題
- [x] 確保使用者可以透過修改檔名來控制題目標題
- [x] 測試功能並儲存檢查點




## 修改側邊欄選單名稱（2025-01-23）

- [x] 將「題庫管理」改名為「單選題庫」
- [x] 將「題庫檔案」改名為「試卷題庫」
- [x] 更新 DashboardLayout.tsx 中的選單項目
- [x] 更新相關頁面的標題和描述
- [x] 測試選單顯示
- [x] 儲存檢查點




## 考題出處欄位優化和 AI 出題單複選題區分（2025-01-23）

- [x] 在 AI 分析頁面的「考題出處」欄位下方新增填寫範例說明
- [x] 優化 AI 出題 prompt，明確區分單選題和複選題
- [x] 測試 AI 出題功能
- [x] 儲存檢查點





## 複選題完整支援（2025-01-23）

### 1. 複選題答案驗證邏輯
- [x] 修改考試作答頁面（ExamTake.tsx），支援複選題的多選功能
- [x] 修改評分邏輯（grading.ts），實作複選題的正確評分（完全正確才給分）
- [x] 測試複選題作答和評分功能

### 2. 題型篩選功能
- [x] 在單選題庫頁面（QuestionBank.tsx）加入題型篩選下拉選單
- [x] 整合篩選邏輯到現有的搜尋和篩選系統
- [x] 測試題型篩選功能

### 3. AI 出題結果預覽優化
- [x] 在 AI 分析結果頁面（AIAnalysis.tsx）為複選題加入視覺標記
- [x] 使用 Badge 或圖示區分不同題型
- [x] 測試視覺效果

### 4. 最終測試和交付
- [x] 完整測試所有功能
- [x] 儲存檢查點





## 首頁 LOGO 和 AI 智能分類標籤功能（2025-01-23）

### 1. 首頁歡迎訊息加入晨陽 LOGO
- [x] 處理晨陽 LOGO 圖片（去背或優化）
- [x] 將 LOGO 加入專案靜態資源
- [x] 在首頁歡迎訊息左側加入 LOGO
- [x] 調整版面配置確保美觀
- [ ] 測試不同螢幕尺寸的顯示效果

### 2. AI 智能分類和標籤建議功能
- [ ] 修改 AI 分析 prompt，加入分類和標籤建議
- [ ] 在 AI 分析結果中回傳建議的分類和標籤
- [ ] 在 AI 分析結果預覽頁面顯示建議的分類和標籤
- [ ] 實作將 AI 建議儲存到題目資料的功能

### 3. 題庫管理自動下拉選擇機制
- [ ] 在單選題庫新增/編輯對話框加入分類下拉選單
- [ ] 在單選題庫新增/編輯對話框加入標籤多選下拉選單
- [ ] 整合 AI 建議的分類和標籤到下拉選單
- [ ] 實作標籤的自動完成和建議功能
- [ ] 測試下拉選擇機制

### 4. 最終測試和交付
- [ ] 測試完整的 AI 分析到題庫管理流程
- [ ] 測試分類和標籤的建議和選擇功能
- [ ] 儲存檢查點






## 建立考試時考試標題下拉選單功能（2025-01-23）

### 需求說明
- 在建立考試頁面的「考試標題」欄位加入下拉選單
- 下拉選單顯示已發佈題目的標題，方便選擇作為考試名稱

### 實作任務
- [x] 分析現有考試建立功能與資料結構
- [x] 確認「已發佈題目」的定義（試卷題庫中的題目）
- [x] 實作後端 API：取得已發佈題目標題列表
- [x] 修改前端考試建立表單，將標題欄位改為可輸入的下拉選單（Combobox）
- [x] 整合下拉選單到考試建立對話框
- [x] 測試功能（可選擇已有標題或自行輸入新標題）
- [x] 儲存檢查點






## 緊急修復：考試列表頁面 NaN 驗證錯誤（2025-01-23）

- [ ] 診斷錯誤原因（tRPC 預期 number 但收到 NaN）
- [ ] 檢查考試列表頁面的 tRPC query 參數
- [ ] 修復 NaN 參數傳遞問題
- [ ] 測試修復結果
- [ ] 儲存檢查點





## 建立考試精靈快速設定分數功能（2025-01-23）

### 需求說明
- 在建立考試精靈的步驟3（設定分數）中新增快速設定分數功能
- 讓使用者可以一鍵將所有題目設定為相同分數

### 實作任務
- [x] 在 CreateExamWizard.tsx 步驟3加入快速設定分數輸入框和按鈕
- [x] 實作批次設定所有題目分數的功能
- [x] 測試快速設定分數功能
- [x] 儲存檢查點





## 修復考試答題頁面 React key prop 錯誤（2025-01-23）

- [x] 診斷 ExamTake.tsx 中缺少 key prop 的元素
- [x] 為列表中的子元素加入唯一的 key prop
- [x] 測試修復結果







## 調整首頁側邊欄順序 - 考試管理位置（2025-01-23）

- [x] 將「考試管理」移到「考試園地」之上
- [x] 測試選單顯示順序
- [x] 儲存檢查點






## 「回到昨日 21:00 程式」功能實作（2025-01-24）

### 需求說明
- 實作時間回溯功能，讓使用者可以查看「昨日晚上 21:00」時的考試狀態和答題記錄
- 提供時間選擇器，讓使用者可以選擇任意時間點查看歷史資料

### 實作任務
- [ ] 分析現有資料結構，確認時間戳記欄位
- [ ] 設計時間回溯查詢邏輯（基於 createdAt/updatedAt）
- [ ] 實作後端 API：根據時間點篩選考試和答題記錄
- [ ] 建立時間選擇器元件（支援快速選擇「昨日 21:00」）
- [ ] 建立歷史資料查看頁面
- [ ] 整合時間篩選到現有的考試列表和統計頁面
- [ ] 測試時間回溯功能
- [ ] 儲存檢查點




## 移除首頁 LOGO（2025-01-24）

- [x] 移除首頁歡迎訊息中的晨陽 LOGO
- [x] 調整首頁版面配置
- [x] 測試首頁顯示效果
- [x] 儲存檢查點




## 緊急修復：檢查點記錄未找到錯誤（2025-01-24）

- [x] 診斷「[internal] failed to get checkpoint: record not found」錯誤原因
- [x] 建立初始檢查點以解決錯誤
- [x] 測試檢查點功能
- [x] 儲存檢查點




## 緊急修復:檢查點記錄未找到錯誤(2025-01-24)

- [x] 診斷錯誤原因([internal] failed to get checkpoint: record not found)
- [ ] 建立新的檢查點以解決發佈問題
- [ ] 測試發佈功能
- [ ] 確認檢查點功能正常

## 建立專案檢查點以啟用發佈功能(2025-01-24)

- [x] 確認所有核心功能運作正常
- [x] 建立專案檢查點
- [x] 測試發佈功能
- [x] 確認檢查點記錄存在


