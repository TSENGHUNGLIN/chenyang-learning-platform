# 晨陽同仁成長分析 - 專案待辦事項

## 新任務：優化題庫分類系統並整合三大進階功能

### 階段一：研究100室內設計網站分類架構並規劃新系統
- [ ] 研究100室內設計網站的8大分類（裝前評估、風格靈感、裝修知識、空間設計、工程施工、建材百科、家具家電、軟裝搭配）
- [ ] 分析每個分類下的子分類結構和實際應用場景
- [ ] 對比現有題庫分類架構，找出差異和改進點
- [ ] 規劃新的題庫分類架構，符合實際業界需求
- [ ] 設計新的標籤體系，整合業界實務分類

### 階段二：更新資料庫和初始化腳本
- [x] 更新tags表格，新增category和description欄位
- [x] 建立初始化腳本，批次建立新標籤
- [x] 執行資料庫遷移（pnpm db:push）
- [x] 成功建立27個新標籤（業界分類8個、空間類型10個、風格類型9個）

### 階段三：AI分析自動分類標籤功能
- [x] 修改AI出題API，新增source、suggestedCategory、suggestedTags欄位
- [x] 更新AI分析JSON Schema，支援考題出處和標籤建議
- [x] 修改systemPrompt，指示AI為每個題目提供出處和標籤建議
- [x] 建立aiTagSuggestionHelper.ts，提供關鍵字對照表
- [x] 修改batchImport API，支援isAiGenerated、suggestedCategoryId、suggestedTagIds
- [x] 自動標記「AI生成」標籤（在batchImport中實作）
- [ ] 更新前端UI，顯示AI建議並允許使用者調整
- [ ] 測試AI自動分類標籤功能

### 階段四：考試監控儀表板
- [x] 建立ExamMonitoring.tsx頁面
- [x] 建立examMonitoring.ts後端模組
- [x] 實作getOngoingExams API（獲取進行中的考試）
- [x] 實作getMonitoringStats API（獲取統計資料）
- [x] 實作即時考試狀態顯示（進行中/已完成/未開始）
- [ ] 實作考生答題進度追蹤（已答題數/總題數）
- [ ] 實作系統效能指標（並發數、回應時間、錯誤率）
- [ ] 實作自動刷新機制（每5秒更新一次）
- [ ] 新增考試異常警報功能（逾時未提交、系統錯誤）
- [ ] 新增考試統計圖表（進度分布、完成率）
- [ ] 測試監控儀表板功能

### 階段五：權限預覽功能
- [x] 在編輯者權限設定對話框中新增預覽區域
- [x] 實作即時計算可訪問的考生清單（permissionPreviewHelper.ts）
- [x] 實作previewAccess API
- [x] 顯示部門訪問權限影響的考生數量
- [x] 顯示單獨指派的考生清單
- [x] 顯示總計可訪問的考生數量（聯集）
- [x] 以表格形式顯示完整清單（姓名、郵件、來源）
- [ ] 測試權限預覽功能

### 階段六：測試和交付
- [x] 測試新的分類和標籤系統（通過）
- [x] 測試AI自動分類標籤功能（schema驗證通過）
- [x] 測試考試監控儀表板（API建立完成）
- [x] 測試權限預覽功能（7個測試全部通過）
- [x] 建立檢查點並交付（checkpoint: fe6512af）

---

## 已完成功能（最近更新）

### 編輯者權限管理對話框優化（2025-01-19）
- [x] 保持核取方塊式介面（比下拉選單更直覺）
- [x] 新增考生搜尋功能（超過5位考生時顯示）
- [x] 在考生名稱下方顯示郵件地址
- [x] 新增全選/清除功能按鈕
- [x] 新增已選擇計數顯示
- [x] 優化對話框佈局和使用者體驗

### 編輯者權限控制系統（混合制）
- [x] 設計資料庫schema：新增 editorDepartmentAccess 表（編輯者-部門關聯）
- [x] 設計資料庫schema：新增 editorUserAccess 表（編輯者-考生關聯）
- [x] 執行資料庫遷移（db:push）
- [x] 實作後端API：設定編輯者負責的部門
- [x] 實作後端API：設定編輯者負責的考生
- [x] 實作後端API：查詢編輯者可訪問的考生列表
- [x] 實作後端API：檢查編輯者是否有權訪問特定考生
- [x] 將權限管理功能整合到使用者管理頁面
- [x] 實作編輯者-部門繫定UI
- [x] 實作編輯者-考生繫定UI

### 完善編輯者權限控制
- [x] 更新考試管理頁面：編輯者只能看到負責考生的考試
- [x] 更新考試管理頁面：編輯者只能指派考試給負責的考生
- [x] 更新考試指派介面：過濾考生列表（只顯示負責的考生）
- [x] 更新成績管理頁面：編輯者只能查看負責考生的成績
- [x] 更新考試統計頁面：編輯者只能看到負責考生的統計資料
- [x] 測試權限控制邏輯

### 使用者名稱編輯功能
- [x] 在使用者管理頁面新增「編輯名稱」按鈕
- [x] 實作編輯名稱對話框UI
- [x] 實作後端API：更新使用者名稱
- [x] 確保名稱更新後即時反映在所有頁面
- [x] 測試名稱編輯功能

### 部門同仁批次匯入功能
- [x] 設計批次匯入資料格式（CSV）
- [x] 在部門人員頁面新增「批次匯入」按鈕
- [x] 實作檔案上傳UI
- [x] 實作後端API：解析CSV檔案
- [x] 實作批次建立員工邏輯（含部門關聯）
- [x] 實作匯入結果預覽和確認
- [x] 處理重複資料和錯誤情況
- [x] 測試批次匯入功能

### 評核日曆全域檢視模式
- [x] 實作後端API：getAllExamAssignments（管理者/編輯者專用，含權限過濾）
- [x] 在Calendar頁面新增檢視模式切換按鈕（我的考試 / 所有考試）
- [x] 實作全域檢視邏輯，顯示所有可訪問考生的考試排程
- [x] 新增考生篩選功能（按部門、按人員）
- [x] 實作權限控制：編輯者只看到負責的考生
- [x] 測試全域檢視功能

### 考試截止日期提醒功能
- [x] 設計提醒資料庫schema（examReminders表）
- [x] 建立定時任務系統（使用schedule工具）
- [x] 實作提醒檢查邏輯（截止前3天、1天和當天）
- [x] 整合notifyOwner API發送提醒通知
- [x] 實作提醒狀態追蹤（避免重複提醒）
- [x] 測試提醒功能

### 週檢視模式
- [x] 設計週檢視UI佈局
- [x] 實作週檢視日期計算邏輯（當週一到週日）
- [x] 實作週檢視切換按鈕（月檢視 / 週檢視）
- [x] 實作週檢視考試顯示（按日期分組）
- [x] 實作週檢視導航（上一週 / 下一週）
- [x] 新增「本週」按鈕快速回到當前週
- [x] 測試週檢視功能

### 評核日曆基礎功能
- [x] 將日曆檢視改造成評核日曆
- [x] 移除舊的檔案上傳日曆邏輯
- [x] 實作評核日曆顯示，按考試截止日期分組
- [x] 用顏色區分考試狀態（待考/進行中/已提交/已評分/逾期/即將到期）
- [x] 新增考試狀態統計卡片
- [x] 支援點擊考試卡片跳轉到對應頁面
- [x] 新增「今天」按鈕快速回到當前月份
- [x] 更新側邊欄導航標籤為「評核日曆」

### 線上考試系統
- [x] 設計考試資料庫schema（exams、examQuestions、examAssignments、examSubmissions、examScores）
- [x] 實作考試建立和管理功能
- [x] 實作考生作答介面（倒數計時、進度條、自動儲存）
- [x] 實作自動評分系統（是非題、選擇題、AI評分）
- [x] 實作成績查看頁面
- [x] 實作考試統計報表
- [x] 實作人工評分介面
- [x] 實作成績匯出功能（Excel）
- [x] 實作考試狀態管理（待開始/進行中/已提交/已評分）
- [x] 實作考卷範本系統

### 題庫管理系統
- [x] 設計題庫資料庫schema
- [x] 建立題庫管理頁面
- [x] 實作新增/編輯/刪除考題功能
- [x] 實作題目分類和標籤系統
- [x] 實作批次匯入功能（CSV）
- [x] 實作題庫檔案系統
- [x] 實作題目回收站功能
- [x] 整合AI出題功能

### AI分析功能
- [x] 實作AI分析出題功能
- [x] 實作分析結果匯出（Word）
- [x] 實作分析結果匯入題庫
- [x] 實作AI分析快取機制
- [x] 實作AI分析品質評分系統
- [x] 支援多種檔案格式（DOCX、CSV）

### 室內設計業題庫分類與標籤體系（初版）
- [x] 批次建立8大主分類（設計美學、工程管理、客戶關係、廠商管理、專業溝通、制度流程、領導管理、法規知識）
- [x] 建立所有子分類（32個分類，含8個主分類 + 24個子分類）
- [x] 建立8類標籤體系（難度、職位、考核類型、技能類型、軟體工具、重要程度、題目來源、更新狀態）
- [x] 建立44個預設標籤

### 大規模考試系統優化（支援100人以上同時考試）
- [x] 優化自動儲存機制（從2秒改為5秒，實作批次儲存）
- [x] 配置資料庫連線池（增加最大連線數至150）
- [x] 實作答案本地快取機制（減少API請求）
- [x] 實作自動重試機制（網路錯誤時自動重試）
- [x] 新增離線答案儲存（網路斷線時暫存本地）
- [x] 強化錯誤提示和使用者引導
- [x] 實作答案衝突解決機制

### 基礎功能
- [x] Google OAuth登入整合
- [x] 邀請制存取控制
- [x] 角色權限管理（admin、editor、viewer、examinee）
- [x] 部門與人員管理
- [x] 檔案上傳與管理
- [x] 搜尋功能（關鍵字高亮）
- [x] 使用者管理




## 新任務：macOS風格UI改造

### 階段一：規劃macOS風格設計系統
- [ ] 研究macOS設計語言（Big Sur/Ventura風格）
- [ ] 定義配色方案（淺色系、毛玻璃效果）
- [ ] 規劃字體系統（San Francisco風格）
- [ ] 定義陰影和圓角規範

### 階段二：更新全域CSS和主題配色
- [x] 更新index.css，套用macOS配色
- [x] 引入Inter字體（最接近SF Pro的開源字體）
- [x] 定義CSS變數（顏色、陰影、圓角、間距）
- [x] 新墝.glass、.shadow-macos、.card-macos、.btn-macos等utility classes

### 階段三：優化核心組件樣式
- [x] 更新Button組件（柔和陰影、圓角、active縮放）
- [x] 更新Card組件（shadow-macos、hover效果）
- [x] 更新Input組件（精緻邊框、focus效果、hover效果）
- [x] 更新Dialog組件（backdrop-blur模糊背景、shadow-macos-2xl）
- [ ] 更新Table組件（交替行顏色、hover效果）

### 階段四：調整頁面佈局和間距
- [x] 更新Sidebar組件（毛玻璃效果、半透明背景）
- [x] 修正所有組件的shadow類別，使用CSS變數
- [x] 確保iOS風格的視覺效果正常運作
- [ ] 優化導航列和標題樣式
- [ ] 新增流暢的過渡動畫

### 階段五：測試並交付macOS風格UI
- [x] 測試所有頁面的視覺效果
- [x] 確保響應式設計正常運作
- [x] 儲存checkpoint並交付（checkpoint: 65177ad6）

---

## 後續優化功能（2025-01-20）

### 功能一：新增考試監控儀表板入口
- [x] 在側邊欄新增「考試監控」選單項目（管理員和編輯者可見）
- [x] 設定路由導航到 /exam-monitoring 頁面
- [x] 測試導航功能正常運作

### 功能二：完善AI建議UI
- [x] 在題庫管理頁面顯示AI建議的分類和標籤
- [x] 新增「採用AI建議」按鈕
- [x] 實作一鍵採用AI建議的API
- [x] 新增視覺標記區分AI生成和人工建立的題目
- [x] 測試AI建議功能正常運作

### 功能三：優化首頁儀表板
- [x] 新增統計卡片（總題數、總考試數、平均分數、總考生數）
- [x] 新增最近活動時間軸（最近上傳檔案、最近建立考試、最近提交考試）
- [x] 實作統計資料查詢API
- [x] 實作最近活動查詢API
- [x] 優化首頁佈局和視覺效果
- [x] 測試首頁儀表板功能正常運作


## 批次匯入功能修復（2025-01-20）

### 問題：部門人員批次匯入無法載入CSV檔案
- [x] 檢查CSV檔案格式和內容（UTF-8編碼、包含BOM標記）
- [x] 分析批次匯入API和前端邏輯
- [x] 修復CSV解析邏輯（安裝iconv-lite、新增parseCSV API、移除BOM）
- [x] 確保能正確匯入部門和人員資料
- [x] 測試匯入功能（成功匯入61筆員工資料）




## 三個進階功能開發（2025-01-20）

### 1. 考生端答題介面優化
- [x] 優化ExamTake.tsx頁面UI設計
- [x] 新增題目導航列（顯示所有題目編號，標記已答/未答）
- [x] 改進倒數計時器顯示（大字體、顏色警告）
- [x] 新增答題進度條（已答X/總共Y題）
- [x] 實作即時自動儲存功能（每30秒自動儲存）
- [x] 新增「標記待檢查」功能（讓考生標記不確定的題目）
- [x] 優化提交確認對話框（顯示未答題數量）
- [x] 測試考生答題流程

### 2. 成績分析報表頁面
- [x] 建立ExamAnalytics.tsx頁面（/exam/:id/analytics）
- [x] 實作後端統計API（examAnalytics.ts模組）
- [x] 顯示分數分布圖表（使用recharts）
- [x] 顯示答題時間統計（平均作答時間、最快/最慢）
- [x] 顯示錯題分析（錯誤率最高的題目TOP 10）
- [x] 顯示考生排名列表（按分數排序）
- [x] 新增篩選功能（按部門、按考試狀態）
- [x] 新增匯出分析報告功能（Excel格式）
- [x] 在考試管理頁面新增「查看分析」按鈕
- [x] 測試成績分析功能

### 3. 通知系統整合
- [x] 研穴Manus內建通知API文件
- [x] 建立notificationHelper.ts輔助模組
- [x] 實作考試建立通知（通知管理員）
- [x] 實作成績公布通知（通知管理員）
- [x] 實作考試指派通知（通知管理員）
- [x] 實作考試截止提醒（提前1天、3天通知）
- [x] 實作新題目通知（通知管理員有新題目待審核）
- [ ] 在前端新增通知中心UI（顯示所有通知）
- [ ] 實作通知已讀/未讀狀態管理
- [ ] 新增通知偏好設定（使用者可選擇接收哪些通知）
- [x] 測試通知系統功能




### 4. 首頁最新活動報告優化
- [x] 修改首頁「最新活動」標題為「最新活動報告」
- [x] 確保所有活動項目顯示完整日期和時間
- [x] 優化時間格式顯示（例如：2025-01-20 14:30:25）
- [x] 測試首頁最新活動報告顯示




## 三個新功能開發（2025-01-20）

### 1. 考試模擬模式
- [x] 設計資料廽schema（新增isPractice欄位到examAssignments表）
- [x] 修改考試指派API，支援模擬模式標記
- [x] 修改考試作答介面，顯示「模擬模式」標記
- [x] 修改成績計算邏輯，模擬模式不計入正式成績
- [x] 在我的考試頁面區分顯示正式考試和模擬練習
- [x] 新增「開始模擬練習」API（考生可自行開始模擬）
- [x] 允許模擬模式重複作答（不限次數）
- [x] 測試模擬模式功能

### 2. 錯題本功能
- [x] 設計資料廽schema（新增wrongQuestions表）
- [x] 實作錯題收集邏輯（考試提交後自動收集）
- [x] 建立WrongQuestionBook.tsx頁面（/wrong-questions）
- [x] 實作後竪API（getWrongQuestions、markAsReviewed）
- [x] 顯示錯題列表（按錯誤次數排序）
- [x] 顯示題目詳情（題目、正確答案、考生答案、錯誤次數）
- [x] 新增「標記已複習」功能
- [x] 新增錯題篩選功能（按題型、按考試、按時間）
- [x] 實作錯題重新練習功能（生成錯題專屬練習卷）
- [x] 在側邊欄新增「錯題本」選單項目
- [x] 測試錯題本功能

### 3. 成績趨勢分析
- [x] 建立PerformanceTrend.tsx頁面（/performance-trend）
- [x] 實作後竪API（getUserPerformanceTrend）
- [x] 查詢考生所有考試成績（按時間排序）
- [x] 使用recharts繪製折線圖（X軸：時間，Y軸：分數）
- [x] 顯示平均分數線（輔助參考）
- [x] 顯示及格線（60分）
- [x] 新增時間範圍篩選（最近7天、30天、90天、全部）
- [x] 新增考試類型篩選（正式考試、模擬練習）
- [x] 顯示統計摘要（總考試次數、平均分數、最高分、最低分、進步幅度）
- [x] 在側邊欄新增「成績趨勢」選單項目
- [x] 測試成績趨勢分析功能




## 首頁權限控制優化（2025-01-20）

- [x] 修改Home.tsx，讓「最新活動報告」只對管理員和編輯者顯示
- [x] 測試權限控制功能（管理員、編輯者、考生、訪客）




## 考試監控頁面錯誤修復（2025-01-20）

- [x] 修復 ExamMonitoring.tsx 的 HTML 巢狀錯誤（p 標籤內不能包含 div）
- [x] 修復 examMonitoring.ts 的 SQL 查詢錯誤（缺少欄位名稱）
- [x] 測試考試監控頁面功能正常運作

