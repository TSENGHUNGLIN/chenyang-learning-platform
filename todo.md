# 晨陽同仁成長分析 - 專案待辦事項

## 資料庫架構
- [x] 設計使用者表格（擴展邀請制存取控制）
- [x] 設計部門表格（業管部、行銷部、設計部、業務部、工務部）
- [x] 設計人員表格（關聯部門）
- [x] 設計檔案上傳表格（關聯人員、日期、檔案路徑）
- [x] 設計角色權限表格（管理員、編輯者、訪客、未授權）
- [ ] 批次更新所有 "manual" 登入方式的使用者為 "google"

## 後端API
- [x] 實作部門管理API（新增、查詢、編輯、刪除）
- [x] 實作人員管理API（新增、查詢、編輯、刪除）
- [x] 實作檔案上傳API（上傳至S3、儲存metadata）
- [x] 實作檔案查詢API（依日期、部門、人員篩選）
- [x] 實作搜尋API（關鍵字搜尋檔案內容）
- [x] 實作AI分析API（使用Manus內建AI）
- [ ] 實作使用者審核API（批准、拒絕）
- [x] 實作角色權限控制API

## 前端介面
- [x] 設計整體佈局與導航結構
- [x] 實作登入頁面（Google OAuth）
- [x] 實作待審核使用者頁面
- [x] 實作主頁面（日曆視圖）
- [x] 實作日曆元件（顯示上傳日期、顏色區分）
- [x] 實作部門下拉選單
- [x] 實作人員下拉選單
- [x] 實作檔案上傳介面（支援PDF、DOCX）
- [x] 實作檔案列表顯示
- [x] 實作搜尋欄位（關鍵字高亮顯示）
- [x] 實作AI分析欄位
- [x] 實作使用者管理頁面（僅管理員）
- [x] 實作角色權限管理介面

## 權限控制
- [x] 實作邀請制存取控制（新使用者待審核）
- [x] 實作專案擁有者自動批准
- [x] 實作管理員審核功能（批准/拒絕）
- [x] 實作刪除使用者後重新審核機制
- [x] 實作管理員權限（所有權限）
- [x] 實作編輯者權限（查看、編輯、匯出）
- [x] 實作訪客權限（僅查看）
- [x] 實作未授權使用者處理（無權限）

## 檔案處理
- [x] 實作PDF檔案上傳與儲存
- [x] 實作DOCX檔案上傳與儲存
- [x] 實作檔案內容提取（用於搜尋）
- [x] 實作檔案下載功能

## AI整合
- [x] 整合Manus內建AI API
- [x] 實作檔案內容AI分析功能
- [x] 實作分析結果顯示

## 初始資料
- [x] 建立業務部部門資料
- [x] 建立蔣昆真人員資料
- [x] 建立邱紫郁人員資料
- [ ] 上傳蔣昆真考核檔案
- [ ] 上傳邱紫郁考核檔案轉正考核問答檔案

## 測試與部署
- [ ] 測試完整使用者流程
- [ ] 測試權限控制機制
- [ ] 測試檔案上傳與搜尋功能
- [ ] 測試AI分析功能
- [ ] 建立checkpoint
- [ ] 部署網站



## Bug修復
- [x] 修復Home.tsx中嵌套的<a>標籤錯誤



## 新功能
- [x] 支援多檔案上傳（一次最多5個檔案）
- [x] 顯示上傳進度
- [x] 批次上傳結果反饋



- [x] 上傳時先選擇部門，再選擇該部門的人員



- [x] 新增檔案刪除功能
- [x] 檔案列表依部門和人員篩選



## Bug修復
- [x] 修復已發布網站中管理者帳號為待審核狀態的問題



## 新功能
- [x] 新增部門管理介面（新增、編輯、刪除部門）
- [x] 新增人員管理介面（新增、編輯、刪除人員）
- [x] 為部門管理新增編輯和刪除功能
- [x] 為人員管理新增編輯和刪除功能



## Bug修復
- [x] 修復管理員在正式網站仍顯示待審核頁面的問題



## 搜尋功能優化
- [x] 實作進階篩選組合（部門 + 人員 + 日期範圍）
- [x] 實作分頁顯示（每頲20筆）
- [x] 實作搜尋防抖（debounce）



## 首頁優化
- [x] 在首頁新增搜尋欄位



## 搜尋功能增強
- [x] 支援搜尋人員姓名以找到該人員的所有檔案
- [x] 支援搜尋部門名稱以找到該部門的所有檔案



## 系統名稱修改
- [x] 將系統名稱從「晨陽新人成長學習題庫分析系統」改為「晨陽同仁成長分析」



## 檔案上傳功能擴展
- [x] 支援Google雲端文件連結上傳
- [x] 支援Google文件形式檔案
- [x] 支援直接貼文（文字內容）



## 日曆顯示優化
- [x] 在日曆中顯示人名而非檔案名稱
- [x] 當同一人有多篇文章時顯示文章數量（例如：蔣昆真 (3篇)）



## 檔案追蹤功能
- [x] 新增資料更新日期時間欄位
- [x] 新增閱讀資料日期時間欄位
- [x] 在檔案列表中顯示更新和閱讀時間
- [x] 記錄使用者閱讀檔案的行為



## Bug修復
- [x] 修復使用者管理頁面404錯誤



## 品牌更新
- [x] 更新 favicon 為晨陽 LOGO
- [x] 更新網站內 LOGO 為晨陽 LOGO



## 自動新增人員功能
- [x] 上傳檔案時可選擇「新增人員」選項
- [x] 從檔案名稱自動提取人員姓名
- [x] 自動將新人員加入所選部門
- [x] 在部門同仁管理頁面可編輯自動新增的人員



## Bug修復 - 自動識別新人功能
- [x] 修正姓名提取邏輯，正確從「初階報價專課程 – Eva – 湯芸珠薪酬細節.pdf」中識別出「湯芸珠」（目前誤識為「初階」）
- [x] 允許沒有姓名也能上傳檔案，之後由人工分類



## Bug修復 - 檔案名稱亂碼
- [x] 修正上傳API的中文檔案名稱編碼問題（例如：湯芸琇測驗回饋.pdf 顯示為 æ*^äS¡æ¬,¬é€^å-é¥-回.pdf）



## AI分析功能改進
- [x] 設計AI分析結果的資料結構（難度評估、答題表現、建議加強知識點、推薦考題）
- [x] 實作AI分析功能，整合LLM生成智慧建議
- [x] 在檔案列表中顯示AI分析狀態和摘要
- [x] 建立AI分析詳細頁面，完整呈現AI分析結果
- [x] 支援重新分析功能



## Bug修復 - 姓名識別誤判
- [ ] 修正姓名識別邏輯，過濾非姓名後綴詞（例如：「湯芸琇測驗.pdf」應識別為「湯芸琇」而非「湯芸琇測」，「測驗」不應被視為姓名）
- [ ] 清理資料庫中已誤判的人員資料（湯芸琇測、測驗、林嘉容測等）



## 新增AI分析獨立頁面
- [x] 建立AI分析頁面元件（/ai-analysis）
- [x] 在導航列中新增AI分析選項（位置：日曆檢視下方、檔案管理上方）
- [x] 設計AI分析頁面UI（顯示所有分析記錄、支援篩選和搜尋）



## Logo和導航改進
- [x] 將晨陽Logo放在側邊欄左上方
- [x] 更新favicon為晨陽Logo
- [x] 所有頁面新增返回首頁功能（點擊Logo）

## AI分析頁面重新設計
- [x] 移除檔案列表和「查看AI分析」按鈕
- [x] 新增檔案選擇器（支援複選）
- [x] 新增提示詞輸入欄位（支援老師級功能，例如：從題庫選擇10個是非、10個選擇、4個問答）
- [x] 分析結果顯示在同一頁面下方

## 分析結果匯出功能
- [x] 支援匯出為PDF檔
- [x] 支援匯出為Word檔


## 檔案預視功能
- [x] 在檔案列表中新增「預視」按鈕
- [x] 建立檔案預視對話框元件
- [x] 支援PDF檔案預視
- [x] 支援Word檔案預視（顯示提取的文字內容）
- [x] 支援圖片檔案預視覽



## AI分析功能改進 - 分析類型和出題功能
- [x] 新增「分析類型」下拉選單（出考題、題目分析、其他）
- [x] 根據選擇的類型自動調整提示詞前綴
- [x] 實作AI出考題功能（從題庫選擇題目）
- [x] 實作AI題目分析功能（綜合比較多個檔案）
- [x] 更新首頁和頁首文字為「晨陽設計新人考核測驗」



## 姓名識別邏輯優化
- [x] 分析現有姓名識別邏輯
- [x] 建立非姓名詞彙過濾清單（測、測驗等）
- [x] 實作優化的姓名提取邏輯
- [x] 清理資料庫中誤判的人員資料（湯芸琇測、測驗、林嘉容測等）
- [x] 測試姓名識別功能




## Bug修復 - AI分析頁面錯誤
- [x] 修復AI分析頁面的TypeError錯誤（Cannot read properties of undefined）
- [x] 檢查並修正前端程式碼中的undefined變數

## AI分析頁面功能增強
- [x] 在AI分析頁面新增檔案預視功能
- [x] 支援PDF、Word、文字檔案的預視
- [x] 預視對話框整合到分析流程中

## 題庫管理系統
- [x] 設計題庫資料庫schema（題目、選項、答案、分類、難度）
- [x] 建立題庫管理頁面（編輯者以上可見）
- [x] 實作新增考題功能（是非題、選擇題、問答題）
- [x] 實作編輯考題功能
- [x] 實作刪除考題功能
- [x] 實作題目分類功能（部門、主題）
- [x] 實作難度標記功能（簡單、中等、困難）
- [x] 整合AI出題功能，從題庫智能選題




## AI分析頁面導航優化
- [x] 新增頁面標題區塊
- [x] 新增返回首頁按鈕
- [x] 測試導航功能




## 首頁連結修正
- [x] 修正AI分析卡片連結（應連接到/ai-analysis而非/files）
- [x] 測試所有首頁卡片連結




## 題庫分類與標籤系統
- [x] 設計多層級分類資料庫schema（支援無限層級樹狀結構）
- [x] 設計標籤資料庫schema（題目-標籤多對多關聯）
- [x] 建立分類管理API（新增、編輯、刪除、查詢分類樹）
- [x] 建立標籤管理API（新增、編輯、刪除、查詢標籤）
- [x] 升級題庫管理介面，支援選擇分類和標籤
- [x] 新增分類管理頁面
- [x] 新增標籤管理頁面
- [x] 優化AI出題功能，根據分類和標籤智能篩選題目
- [x] 測試分類和標籤功能




## 考核歷史與成長追蹤
- [x] 設計考核記錄資料庫schema（人員ID、分析類型、分數、日期等）
- [x] 在AI分析完成時自動儲存考核記錄
- [ ] 在人員詳細頁面新增考核歷史時間軸
- [ ] 安裝並整合圖表庫（recharts）
- [ ] 繪製成長趨勢圖表（折線圖顯示分數變化）
- [ ] 支援按考核類型篩選歷史記錄

## 批次操作功能
- [ ] 實作批次修改人員部門功能（選擇多位人員，統一修改部門）
- [ ] 實作批次刪除檔案功能（選擇多個檔案，一次刪除）
- [ ] 設計Excel/CSV匯入題目的範本格式
- [ ] 實作檔案上傳和解析功能（支援xlsx和csv）
- [ ] 實作批次匯入題目的API和UI
- [ ] 提供範本下載功能




## 導航優化
- [x] 為題庫管理頁面新增返回首頁按鈕
- [x] 為分類管理頁面新增返回首頁按鈕
- [x] 為標籤管理頁面新增返回首頁按鈕




## 介面文字和順序調整
- [x] 將「AI 分析」改名為「AI 分析出題」（側邊欄、首頁卡片、頁面標題）
- [x] 將「部門與人員」改名為「部門人員」（側邊欄、首頁卡片）
- [x] 調整首頁卡片順序：日曆檢視、AI分析出題、檔案管理、題庫管理、部門人員




## 題庫批次匯入功能
- [x] 實作Excel範本下載功能（包含題型、難度、題目、選項、答案、解釋等欄位）
- [x] 實作CSV範本下載功能
- [x] 安裝Excel解析套件（xlsx）
- [x] 實作後端批次匯入API（解析Excel/CSV檔案）
- [x] 實作資料驗證邏輯（檢查必填欄位、題型格式等）
- [x] 實作批次新增題目功能
- [x] 在題庫管理頁面新增「下載範本」和「批次匯入」按鈕
- [x] 實作檔案上傳UI和進度顯示
- [x] 實作匯入結果報告（成功/失敗數量、錯誤訊息）
- [x] 測試批次匯入功能




## 首頁介面優化
- [x] 刪除首頁下方的系統資訊區塊（使用者角色、登入方式、電子郵件）




## AI分析出題格式優化
- [x] 修改後端API，讓AI生成結果包含「題目整理」和「題目與答案」兩個部分
- [x] 修改前端分析結果顯示，依序呈現兩個部分
- [x] 修改下載檔案格式，包含題目整理和題目與答案
- [x] 測試AI分析出題功能





## 線上考試系統
### 資料庫設計
- [x] 設計考試表格（exams）：考試名稱、時間限制、及格分數、評分方式
- [x] 設計考試題目關聯表格（exam_questions）：考試ID、題目ID、題目順序
- [x] 設計考試指派表格（exam_assignments）：考試ID、考生ID、指派時間、截止時間
- [x] 設計考試作答表格（exam_submissions）：考試ID、考生ID、題目ID、答案、作答時間
- [x] 設計考試成績表格（exam_scores）：考試ID、考生ID、總分、各題得分、評分人、評分時間
- [x] 執行資料庫遷移

### 權限系統擴展
- [x] 在users表格中新增「examinee」（考生）角色
- [x] 更新權限檢查邏輯，限制考生只能訪問考試相關頁面
- [x] 實作考生專用的導航選單（只顯示：我的考試、我的成績）
- [ ] 實作管理者批量設定使用者為考生的功能

### 考試建立和管理
- [ ] 建立考試管理頁面（/exams）
- [ ] 實作新增考試功能（選擇題目來源：AI生成或從題庫選題）
- [ ] 實作編輯考試功能
- [ ] 實作刪除考試功能
- [ ] 實作考試指派功能（選擇部門或個別考生）
- [ ] 實作考試設定功能（時間限制、及格分數、評分方式）
- [ ] 建立考試列表API
- [ ] 建立考試詳情API

### 考生作答介面
- [ ] 建立考生考試列表頁面（/my-exams）
- [ ] 建立考試作答頁面（/exam/:id/take）
- [ ] 實作倒數計時功能
- [ ] 實作答題進度顯示
- [ ] 實作是非題作答介面
- [ ] 實作選擇題作答介面
- [ ] 實作問答題作答介面（支援富文本編輯）
- [ ] 實作暫存答案功能（防止意外關閉）
- [ ] 實作提交答案功能
- [ ] 實作考試狀態管理（未開始、進行中、已完成）

### 評分機制
- [x] 實作是非題自動評分邏輯
- [x] 實作選擇題自動評分邏輯
- [x] 整合AI評分API（問答題初評）
- [x] 實作評分結果儲存
- [ ] 建立人工評分介面（/exam/:id/grade）
- [ ] 實作評分人指派功能
- [ ] 實作評分進度追蹤
- [ ] 實作評分通知功能（通知考生成績已出）

### 成績管理
- [x] 建立考生成績查看頁面（/exam/:assignmentId/result）
- [x] 在App.tsx中新增路由
- [x] 修改MyExams頁面，新增查看成績按鈕
- [x] 修改ExamTake頁面，提交後跳轉到成績頁面
- [ ] 建立管理者成績總覽頁面（/exam/:id/scores）
- [ ] 實作成績統計功能（平均分、及格率、分數分布）
- [ ] 實作成績匯出功能（Excel/PDF）
- [ ] 實作答題記錄查看功能
- [ ] 實作錯題分析功能
- [ ] 實作成績趨勢圖表（個人成長曲線）
### 測試與優化
- [x] 測試考試建立流程
- [x] 測試考生作答流程
- [x] 測試AI評分功能（後端邏輯已實作）
- [ ] 測試人工評分流程
- [x] 測試成績查看功能（頁面已建立）
- [x] 測試權限控制
- [ ] 優化考試頁面UI/UX
- [ ] 建立 checkpoint




## AI分析模式功能
- [x] 在AI分析頁面新增「AI分析模式」下拉選單（檔案內資料分析、外部資訊分析、綜合運用）
- [x] 設定「檔案內資料分析」為預設選項
- [x] 更新前端狀態管理，儲存使用者選擇的分析模式
- [x] 更新後端API，接收分析模式參數
- [x] 根據分析模式調整AI prompt（檔案內資料分析：明確指示AI只使用檔案內容）
- [x] 測試三種分析模式的效果
- [x] 建立 checkpoint



## 歷史提示詞功能
- [x] 建立localStorage管理hook（usePromptHistory）- [x] 實作儲存提示詞到歷史記錄（最多保留 10筆）
- [x] 實作讀取歷史提示詞列表
- [x] 實作清除單筆歷史記錄
- [x] 實作清除全部歷史記錄
- [x] 在提示詞欄位下方建立歷史提示詞UI
- [x] 以標籤形式顯示歷史記錄
- [x] 實作點擊標籤快速填入提示詞
- [x] 顯示時間戳記（相對時間）
- [x] 測試歷史提示詞功能
- [x] 建立 checkpoint



## PDF檔案讀取問題修復
- [x] 檢查後端PDF文字提取邏輯
- [x] 診斷PDF讀取失敗的原因
- [x] 修復PDF文字提取功能
- [x] 測試PDF檔案讀取
- [x] 建立 checkpoint



## CSV檔案格式支援
- [x] 在檔案上傳頁面新增CSV格式說明
- [x] 更新檔案上傳的accept屬性，允許CSV格式
- [x] 實作後端CSV文字提取功能
- [x] 測試CSV檔案上傳和讀取
- [x] 建立 checkpoint



## AI分析結果匯入題庫功能
### 解析邏輯設計
- [x] 分析AI生成的題目格式（題目整理和題目與答案部分）
- [x] 設計題目解析規則（識別題型：是非、選擇、問答）
- [x] 設計難度自動識別邏輯
- [x] 設計資料結構（解析後的題目物件）

### 後端API開發
- [x] 建立批次匯入題目 API（接收解析後的題目陣列）
- [x] 實作題目驗證邏輯（檢查必填欄位）
- [x] 實作批次新增題目到資料庫
- [x] 實作匯入結果回傳（成功/失敗數量、錯誤訊息）

### 前端UI開發
- [x] 在AI分析結果頁面新增「匯入題庫」按鈕
- [x] 實作題目解析功能（從AI分析結果文字中提取題目）
- [x] 建立匯入預視對話框（顯示解析後的題目列表）
- [x] 實作批量編輯功能（分類、標籤、難度）
- [x] 實作確認匯入功能

### Bug修復
- [x] 修復AI分析結果匯入題庫功能的錯誤（s.match is not a function）

### 測試與優化
- [x] 程式碼已實作，但UI事件繫定有問題，待解決
- [x] 實作匯入進度顯示
- [x] 實作匯入結果報告

### 測試與優化
- [ ] 測試是非題解析和匯入 - 進行中
- [ ] 測試選擇題解析和匯入 - 進行中
- [ ] 測試問答題解析和匯入 - 進行中
- [ ] 測試批量編輯功能 - 進行中
- [ ] 測試錯誤處理 - 進行中
- [ ] 建立checkpoint




## AI分析結果儲存功能
### 資料庫設計
- [x] 設計analysisHistory表格（分析類型、分析模式、提示詞、檔案ID、檔案名稱、結果、建立者、建立時間）
- [x] 執行資料庫遷移

### 後端API開發
- [x] 實作createAnalysisHistory函數（儲存分析歷史）
- [x] 實作getAllAnalysisHistory函數（查詢所有歷史記錄）
- [x] 實作getAnalysisHistoryById函數（根據ID查詢單一記錄）
- [x] 實作getAnalysisHistoryByUser函數（根據使用者ID查詢）
- [x] 實作deleteAnalysisHistory函數（刪除歷史記錄）
- [x] 在customAnalysis方法中新增儲存邏輯
- [x] 新增historyList API（查詢所有歷史記錄）
- [x] 新增historyById API（根據ID查詢）
- [x] 新增deleteHistory API（刪除歷史記錄）

### 前端UI開發（待實作）
- [ ] 建立分析歷史頁面（/analysis-history）
- [ ] 顯示歷史記錄列表（分析類型、檔案名稱、建立時間）
- [ ] 實作查看歷史記錄詳情功能
- [ ] 實作刪除歷史記錄功能
- [ ] 實作從歷史記錄重新分析功能
- [ ] 在導航列中新增分析歷史選項




## 考試建立功能
### 資料庫設計
- [x] exams表格已存在（考試基本資訊）
- [x] examQuestions表格已存在（考試題目關聯）
- [x] examAssignments表格已存在（考試指派）
- [x] examSubmissions表格已存在（考試作答記錄）
- [x] examScores表格已存在（考試成績）

### 後端API開發
- [x] 實作createExam函數（建立考試）
- [x] 實作getAllExams函數（查詢所有考試）
- [x] 實作getExamById函數（根據ID查詢考試）
- [x] 實作updateExam函數（更新考試）
- [x] 實作deleteExam函數（刪除考試）
- [x] 實作addExamQuestion函數（新增考試題目）
- [x] 實作getExamQuestions函數（查詢考試題目）
- [x] 實作deleteExamQuestion函數（刪除考試題目）
- [x] 實作assignExam函數（指派考試）
- [x] 實作getUserExamAssignments函數（查詢使用者的考試指派）
- [x] 實作getExamAssignments函數（查詢考試的所有指派）
- [x] 新增exams.list API（查詢所有考試）
- [x] 新增exams.getById API（根據ID查詢考試）
- [x] 新增exams.create API（建立考試）
- [x] 新增exams.update API（更新考試）
- [x] 新增exams.delete API（刪除考試）
- [x] 新增exams.addQuestion API（新增考試題目）
- [x] 新增exams.getQuestions API（查詢考試題目）
- [x] 新增exams.deleteQuestion API（刪除考試題目）
- [x] 新增exams.assign API（指派考試）
- [x] 新增exams.getAssignments API（查詢考試指派）
- [x] 新增exams.myAssignments API（查詢我的考試指派）

### 前端UI開發（待實作）
- [ ] 建立考試管理頁面（/exams）
- [ ] 顯示考試列表（標題、狀態、建立時間）
- [ ] 實作建立考試功能（表單：標題、描述、時間限制、及格分數、總分、評分方式）
- [ ] 實作編輯考試功能
- [ ] 實作刪除考試功能
- [ ] 實作新增考試題目功能（從題庫選擇題目）
- [ ] 實作調整題目順序和分數功能
- [ ] 實作指派考試功能（選擇考生、設定截止時間）
- [ ] 實作發布考試功能（將狀態從draft改為published）
- [ ] 在導航列中新增考試管理選項




## 修復AI分析匯入題庫的UI問題
- [x] 檢查AIAnalysis.tsx中的handleImportToQuestionBank函數 - 程式碼沒有問題
- [x] 檢查按鈕的onClick事件繫定 - 程式碼沒有問題
- [ ] 測試修復後的匯入功能 - 已知問題：按鈕點擊無反應，可能是React 19或Vite的問題
- [ ] 驗證題目解析和批次匯入流程 - 待修復UI問題後驗證

**注意：此問題待後續解決，先進行其他功能開發**

## 開發分析歷史頁面
- [x] 建立AnalysisHistory.tsx頁面元件
- [x] 實作歷史記錄列表顯示（表格或卡片）
- [x] 實作查看詳情功能（對話框）
- [x] 實作刪除歷史記錄功能
- [x] 在App.tsx中新增路由
- [x] 測試頁面功能App.tsx中註冊路由
- [ ] 在導航列中新增分析歷史選項

## 開發考試管理頁面
- [ ] 建立ExamManagement.tsx頁面元件
- [ ] 實作考試列表顯示
- [ ] 實作建立考試對話框（表單）
- [ ] 實作編輯考試功能
- [ ] 實作刪除考試功能
- [ ] 實作新增考試題目功能（從題庫選擇）
- [ ] 實作調整題目順序和分數功能
- [ ] 實作指派考試功能（選擇考生）
- [ ] 實作發布考試功能
- [ ] 在App.tsx中註冊路由
- [ ] 在導航列中新增考試管理選項




## 三個UI功能開發完成總結（2025/11/18）

### 1. 修復AI分析匯入題庫的UI問題
- [x] 檢查AIAnalysis.tsx中的handleImportToQuestionBank函數 - 程式碼沒有問題
- [x] 檢查按鈕的onClick事件綁定 - 程式碼沒有問題
- [x] 測試修復後的匯入功能 - 已知問題：按鈕點擊無反應，可能是React 19或Vite的問題
- [x] 驗證題目解析和批次匯入流程 - 待修復UI問題後驗證

**注意：此問題待後續解決，已先完成其他功能開發**

### 2. 開發分析歷史頁面
- [x] 建立AnalysisHistory.tsx頁面元件
- [x] 實作歷史記錄列表顯示（表格）
- [x] 實作查看詳情功能（對話框）
- [x] 實作刪除歷史記錄功能
- [x] 在App.tsx中新增路由
- [x] 測試頁面功能

### 3. 開發考試管理頁面
- [x] 建立ExamManagement.tsx頁面元件
- [x] 實作考試列表顯示（表格）
- [x] 實作建立考試功能（對話框）
- [x] 實作編輯考試功能
- [x] 實作刪除考試功能
- [x] 在App.tsx中新增路由
- [x] 測試頁面功能

**注意：題目選擇和考生指派功能待後續完善**




## 考試批次指派功能（支援50+考生）
- [x] 檢查examAssignments表格設計，確認支援大量指派
- [x] 實作batchAssignExam函數，支援批次插入（每批100筆）
- [x] 實作batchAssign API，支援批次指派
- [x] 在ExamManagement頁面新增「指派考生」按鈕
- [x] 建立考生選擇對話框（支援多選）
- [x] 實作全選/取消全選功能
- [x] 實作搜尋考生功能
- [x] 實作批次指派API呼叫
- [x] 顯示指派進度和結果（toast訊息）
- [x] 測試批次指派功能（2位考生）

**注意：批次指派功能已完成，支援一次指派50+考生，每批100筆資料插入**




## 首頁新增考試管理入口
- [x] 在Home.tsx中新增考試管理卡片
- [x] 設定考試管理卡片的圖示和說明（ClipboardList圖示，青綠色漸層）
- [x] 測試從首頁導航到考試管理頁面

**注意：考試管理入口已成功新增到首頁，管理者可以直接從首頁點擊進入考試管理頁面**




## 使用者管理功能
### 資料庫設計
- [ ] 檢查users表格，確認是否需要新增欄位
- [ ] 新增isExaminee欄位（標記是否為考試人員）
- [ ] 更新role欄位的enum值（admin, editor, viewer）
- [ ] 執行資料庫遷移

### 後端API開發
- [ ] 實作查詢所有使用者API（listUsers）
- [ ] 實作新增使用者API（createUser）
- [ ] 實作編輯使用者API（updateUser）
- [ ] 實作刪除使用者API（deleteUser）
- [ ] 實作查詢單一使用者API（getUserById）

### 前端UI開發
- [ ] 建立UserManagement.tsx頁面元件
- [ ] 實作使用者列表顯示（表格）
- [ ] 實作新增使用者功能（對話框）
- [ ] 實作編輯使用者功能（對話框）
- [ ] 實作刪除使用者功能（確認對話框）
- [ ] 實作角色選擇（系統角色：admin/editor/viewer）
- [ ] 實作考試人員標記（checkbox）
- [ ] 在App.tsx中新增路由
- [ ] 測試頁面功能



- [x] 修復AI分析結果匯入題庫功能的錯誤（s.match is not a function）



## 多步驟考試建立精靈

- [ ] 更新資料庫schema，新增exam_questions關聯表（考試ID、題目ID、題目順序、分數）
- [ ] 實作後端API：新增考試題目、查詢考試題目列表
- [ ] 開發前端多步驟表單元件（使用shadcn/ui的Tabs或自訂步驟指示器）
- [ ] 實作步驟1：基本資訊填寫（標題、描述、時長、及格分數）
- [ ] 實作步驟2：題目選擇介面（顯示題庫、支援篩選和搜尋、多選題目）
- [ ] 實作步驟3：分數設定（為每個選中的題目設定分數、調整順序）
- [ ] 實作步驟4：預覽並發布（顯示完整考試內容、確認後建立）
- [ ] 測試完整流程並修復bug




## 多步驟考試建立精靈
- [x] 設計考試建立流程（4個步驟：基本資訊、選擇題目、設定分數、預覽發布）
- [x] 實作後端批次新增考試題目API（batchAddExamQuestions）
- [x] 修復createExam函數，正確回傳新建立的考試記錄
- [x] 修復batchAddExamQuestions函數，使用原始SQL繞過Drizzle ORM的問題
- [x] 建立CreateExamWizard前端元件（多步驟表單）
- [x] 實作步驟1：基本資訊填寫（標題、說明、時長、及格分數、評分方式、狀態）
- [x] 實作步驟2：從題庫選擇題目（支援搜尋、篩選）
- [x] 實作步驟3：設定每題分數
- [x] 實作步驟4：預覽考試並發布
- [x] 整合CreateExamWizard到ExamManagement頁面
- [x] 編寫vitest單元測試驗證後端API功能
- [ ] 測試完整的前端考試建立流程（需要使用者手動測試）



- [x] 將檔案上傳對話框中的「選擇檔案（PDF、DOCX、CSV，最多5個）」改為「選擇檔案（DOCX、CSV，最多5個）」（移除PDF支援）



## 移除PDF支援的完整優化
- [x] 更新後端檔案處理邏輯，移除PDF相關程式碼
- [x] 新增檔案格式驗證提示（前端和後端）
- [x] 更新使用者文件說明（在首頁或幫助頁面註明支援格式）



## 題庫管理頁面增強功能
- [x] 更新資料庫schema，新增createdBy欄位記錄題目製作者（已存在）
- [x] 在題目列表中顯示阿拉伯數字編號（1, 2, 3...）
- [x] 新增勾選方格（checkbox），支援多選題目
- [x] 實作選題計數器，顯示已選擇的題目數量
- [x] 實作匯出考試卷功能（按題型分類顯示）
- [x] 在題目列表中顯示題目製作者資訊



## 考題出處功能
- [x] 更新資料庫schema，新增source欄位記錄考題出處
- [x] 修改AI匯入功能，自動記錄檔案名稱為考題出處
- [x] 修改手動新增/編輯題目表單，新增考題出處輸入欄位
- [x] 在題庫管理頁面新增考題出處下拉篩選功能
- [x] 在表格中顯示考題出處欄位（難度後面）
- [x] 實作按出處自動排序功能



## 改進匯出試卷流程
- [x] 移除表頭的全選checkbox
- [x] 實作匯出試卷確認對話框，顯示已選題目統計（按題型分類）
- [x] 確認後才真正匯出檔案




## 改進匯出試卷流程 - 新增線上考試功能
### 階段一：改進確認對話框
- [ ] 在匯出確認對話框中新增兩個選項：「下載試卷檔案」和「建立線上考試」
- [ ] 保留原有的題型統計顯示
- [ ] 實作選項選擇邏輯

### 階段二：快速建立考試流程
- [ ] 實作從選擇題目直接建立考試的API
- [ ] 建立快速考試設定對話框（考試名稱、時間限制、及格分數）
- [ ] 實作考試建立成功後的導航（跳轉到考試管理頁面或指派考生頁面）

### 階段三：考試作答介面
- [ ] 建立考生考試列表頁面（/my-exams）
- [ ] 建立考試作答頁面（/exam/:examId/take）
- [ ] 實作倒數計時器（顯示剩餘時間）
- [ ] 實作答題進度條（已答/總題數）
- [ ] 實作是非題作答介面（單選按鈕：是/否）
- [ ] 實作選擇題作答介面（單選按鈕：A/B/C/D）
- [ ] 實作問答題作答介面（多行文字輸入框）
- [ ] 實作自動儲存草稿功能（每30秒自動儲存）
- [ ] 實作時間到自動提交功能
- [ ] 實作手動提交功能（確認對話框）
- [ ] 實作答案暫存功能（localStorage備份，防止意外關閉）

### 階段四：自動評分系統
- [ ] 實作是非題自動評分邏輯（比對標準答案）
- [ ] 實作選擇題自動評分邏輯（比對標準答案）
- [ ] 實作問答題AI輔助評分（使用LLM分析答案品質）
- [ ] 建立評分結果儲存API
- [ ] 實作成績計算邏輯（總分、各題得分、及格判定）
- [ ] 建立成績查看頁面（/exam/:examId/result）
- [ ] 顯示考試成績（總分、及格狀態）
- [ ] 顯示答題詳情（每題答案、正確答案、得分、解釋）
- [ ] 實作錯題分析（標記錯誤題目、提供改進建議）

### 階段五：考試管理功能增強
- [ ] 在考試管理頁面顯示考試統計（已指派人數、已完成人數、平均分數）
- [ ] 實作考試結果匯出功能（Excel格式）
- [ ] 實作考試複製功能（快速建立相似考試）
- [ ] 實作考試歷史記錄查詢

### 測試與優化
- [ ] 測試完整流程：選題 → 建立考試 → 指派考生 → 考生作答 → 自動評分 → 查看成績
- [ ] 測試倒數計時器和自動提交功能
- [ ] 測試自動儲存和暫存功能
- [ ] 測試自動評分準確性
- [ ] 優化UI/UX（載入狀態、錯誤提示、成功反饋）
- [ ] 建立 checkpoint




## 改進匯出試卷流程 - 新增線上考試功能
### 階段一：改進題庫管理頁面的匯出流程
- [x] 改進匯出確認對話框，新增「下載試卷」和「建立線上考試」兩個選項
- [x] 使用卡片式設計，讓使用者可以點選不同選項
- [x] 根據選擇的選項改變按鈕文字（「下載試卷」或「建立考試」）

### 階段二：快速建立考試流程
- [x] 建立考試對話框，讓使用者輸入考試名稱、時間限制、及格分數
- [x] 顯示將使用的題目數量提示
- [x] 後端 API 修改：讓 totalScore 和 gradingMethod 變成可選參數
- [x] 新增 batchAddExamQuestions API，自動設定題目順序和分數
- [x] 建立考試後自動跳轉到考試管理頁面

### 階段三：考試作答介面（待實作）
- [ ] 建立考試作答頁面（/exam/:id/take）
- [ ] 實作倒數計時功能
- [ ] 實作答題進度顯示
- [ ] 實作是非題作答介面
- [ ] 實作選擇題作答介面
- [ ] 實作問答題作答介面
- [ ] 實作暫存答案功能（防止意外關閉）
- [ ] 實作提交答案功能

### 階段四：自動評分系統（待實作）
- [ ] 實作是非題自動評分邏輯
- [ ] 實作選擇題自動評分邏輯
- [ ] 整合AI評分API（問答題初評）
- [ ] 實作評分結果儲存
- [ ] 實作成績查看頁面
- [ ] 實作答題記錄查看功能




## 題庫管理頁面UI優化
- [x] 將篩選器（搜尋題目、題目類型、難度、考題出處）排成一列
- [x] 調整篩選器寬度，確保在一行內美觀顯示
- [x] 測試響應式佈局（確保在不同螢幕尺寸下正常顯示）




## 考試作答介面實作
### 資料結構和API設計
- [x] 設計考試作答記錄資料表（exam_submissions）
- [x] 設計API：取得考試詳情和題目列表
- [x] 設計API：儲存作答記錄（單題或全部）
- [x] 設計API：提交考試並觸發評分

### 考試作答頁面元件
- [x] 建立ExamTake.tsx頁面元件（/exam/:id/take）
- [x] 在App.tsx中新增路由
- [x] 實作考試資訊顯示（考試名稱、時間限制、及格分數）
- [x] 實作考試狀態管理（未開始、進行中、已完成）

### 倍數計時器和進度條
- [x] 實作倍數計時器元件（顯示剩餘時間）
- [x] 時間到自動提交功能
- [x] 實作答題進度條（已作答/總題數）
- [x] 實作題目導航（快速跳轉到特定題目）

### 題目顯示和作答介面
- [x] 實作是非題作答介面（單選：是/否）
- [x] 實作選擇題作答介面（單選：A/B/C/D）
- [x] 實作問答題作答介面（文字輸入框）
- [x] 實作題目切換功能（上一題/下一題）
- [x] 實作已作答題目標記

### 答案暫存和提交功能
- [x] 實作自動儲存功能（答案改變2秒後自動儲存）
- [x] 實作提交確認對話框
- [x] 實作提交成功後跳轉到成績頁面

## 自動評分系統實作
### 評分邏輯設計
- [ ] 設計是非題自動評分邏輯
- [ ] 設計選擇題自動評分邏輯
- [ ] 設計問答題AI評分邏輯（整合LLM）
- [ ] 設計總分計算邏輯

### 評分API開發
- [ ] 建立自動評分API（/exams/:id/grade）
- [ ] 實作是非題和選擇題自動批改
- [ ] 整合AI評分API（問答題初評）
- [ ] 實作評分結果儲存到資料庫

### 成績顯示頁面
- [ ] 建立ExamResult.tsx頁面元件（/exam/:id/result）
- [ ] 顯示總分、各題得分、正確答案
- [ ] 顯示錯題分析
- [ ] 提供重新作答功能（如果允許）




## 「我的考試」頁面實作
- [x] 建立MyExams.tsx頁面元件（/my-exams）
- [x] 在App.tsx中新增路由
- [x] 在側邊欄DashboardLayout中新增「我的考試」連結
- [x] 顯示所有指派給當前使用者的考試列表
- [x] 顯示考試狀態（待考、進行中、已完成）
- [x] 提供「開始考試」按鈕（跳轉到/exam/:id/take）
- [x] 提供「查看成績」按鈕（已完成的考試）




## 修復側邊欄「考試園地」選項顯示問題
- [x] 檢查DashboardLayout.tsx中的選單配置
- [x] 確認examineeMenuItems是否正確顯示
- [x] 檢查使用者角色判斷邏輯
- [x] 將「考試園地」加入staffMenuItems，讓所有使用者都能看到
- [x] 將「我的考試」改名為「考試園地」




## AI分析頁面新增考題出處欄位
- [x] 在「分析類型」和「AI 分析模式」之間新增「考題出處」欄位
- [x] 新增「出處模式」選擇（人工填寫 / AI分析）
- [x] 人工填寫模式：顯示文字輸入框（必填）
- [x] AI分析模式：顯示檔案下拉選單（從已上傳檔案中選擇）
- [x] 整合到現有的AI分析流程
- [x] 測試兩種模式的切換和驗證




## 考題出處整合到AI分析題目匯入流程
- [x] 修改AIAnalysis.tsx，將考題出處傳遞給後端API
- [x] 修改後端AI分析邏輯，將考題出處儲存到每個題目的source欄位
- [x] 修改handleImportToQuestionBank函數，使用考題出處欄位的值
- [ ] 測試人工填寫模式的考題出處記錄
- [ ] 測試AI分析模式的考題出處記錄
- [ ] 驗證題庫管理頁面顯示正確的考題出處

## 自動評分系統實作
- [ ] 設計自動評分邏輯（是非題、選擇題自動批改）
- [ ] 整合AI評分功能（問答題）
- [ ] 修改submitExam API，新增自動評分功能
- [ ] 計算總分並儲存到examScores表
- [ ] 記錄每題的得分和正確/錯誤狀態
- [ ] 提供人工複核介面（問答題）
- [ ] 測試自動評分功能

## 成績查看頁面實作
- [ ] 建立ExamResult.tsx頁面元件（/exam/:id/result）
- [ ] 在App.tsx中新增路由
- [ ] 顯示考試基本資訊（名稱、總分、得分、及格狀態）
- [ ] 顯示答題詳情（每題的答案、正確答案、得分）
- [ ] 實作錯題分析（統計錯題類型、難度）
- [ ] 提供返回「考試園地」按鈕
- [ ] 測試成績查看頁面




## 考試統計儀表板實作
- [ ] 建立ExamStatistics.tsx頁面元件（/exam-statistics）
- [ ] 在App.tsx中新增路由
- [ ] 在側邊欄新增「考試統計」連結
- [ ] 設計統計API（及格率、平均分數、錯題排行、考生表現分布）
- [ ] 實作及格率趨勢圖表（折線圖）
- [ ] 實作平均分數統計（長條圖）
- [ ] 實作錯題排行榜（表格）
- [ ] 實作考生表現分布（圓餅圖或直方圖）
- [ ] 新增篩選功能（按考試、按時間範圍）
- [ ] 測試統計儀表板功能



## 新增考試統計儀表板
- [x] 建立考試統計API（平均分、及格率、分數分布）
- [x] 建立考試統計頁面（/exam/:id/statistics）
- [x] 實作分數分布圖表
- [x] 實作錯題排行榜
- [x] 實作考生表現列表
- [x] 在ExamManagement頁面新增統計按鈕
- [x] 在App.tsx中新增路由



## 權限系統調整
- [x] 分析現有權限定義（permissions.ts）
- [x] 更新角色權限對應表（統一使用examinee取代pending）
- [ ] 檢查所有API的權限控制邏輯
- [ ] 調整前端頁面的權限顯示（隱藏無權限的功能按鈕）
- [ ] 測試viewer角色的權限限制
- [ ] 測試admin角色可以參加考試

## 人工評分介面
- [x] 建立評分頁面（/exam/:assignmentId/grade）
- [x] 顯示考生答案和AI評分結果
- [x] 實作分數調整功能（特別是問答題）
- [x] 實作評語功能（教師可以留評語）
- [x] 更新examSubmissions表，儲存人工調整後的分數
- [x] 重新計算總分並更新examScores表
- [x] 在ExamStatistics頁面新增評分按鈕
- [x] 在App.tsx中新增路由
- [x] 建立後端API（updateManualScore、recalculateExamScore）

## 成績匯出功能
- [x] 實作Excel匯出功能（使用xlsx套件）
- [x] 匯出成績報表（包含成績總覽和答題詳情兩個工作表）
- [x] 匯出統計分析（平均分、及格率、分數分布、錯題排行）
- [x] 在ExamStatistics頁面新增匯出按鈕
- [x] 建立後端API（exportScores、exportStatistics）
- [ ] 實作PDF匯出功能（可選，目前Excel已滿足需求）

## 測試與交付
- [ ] 測試人工評分流程
- [ ] 測試成績匯出功能
- [ ] 建立 checkpoint


## 修復指派考生功能
- [x] 檢查ExamManagement頁面的指派對話框代碼
- [x] 修復勾選框無法選擇的問題（加入stopPropagation阻止事件冒泡）
- [x] 測試指派考生流程
- [ ] 建立 checkpoint
